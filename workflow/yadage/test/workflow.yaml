stages:
  - name: map
    dependencies: [init]
    scheduler:
      scheduler_type: multistep-stage
      parameters:
        input_file: {step: init, output: PU_files}
        output_file: '{workdir}/JRA_PU.root'
        global_tag: {step: init, output: GT}
      workflow: {$ref: subworkflow.yaml}
      batchsize: 5
      scatter:
        method: zip
        parameters: [input_file]
  - name: reduce
    dependencies: [map]
    scheduler:
      scheduler_type: singlestep-stage
      parameters:
        lumi_file_PU: {stages: 'map.[*].list_lumi_PU', output: lumi_file}
        lumi_file_noPU: {stages: 'map.[*].list_lumi_noPU', output: lumi_file}
        output_file: '{workdir}/MatchedFiles'
      step: {$ref: steps.yml#/match_files}